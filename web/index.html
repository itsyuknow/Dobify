<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="a laundry app">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#42A5F5">

  <title>Dobify</title>
  <link rel="manifest" href="manifest.json">

  <!-- ‚úÖ App icon -->
  <link rel="icon" type="image/png" href="icons/dobify_logo.png">

  <!-- Google Maps (deferred) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjxtVK1EXQuaYOc0-a0V5-Wb8xR-koHZ0&amp;libraries=places&amp;v=weekly" defer></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      background: white;
      overflow-x: hidden;
    }
  </style>

  <!-- üîä Leave console ON so web checkout errors are visible -->
  <script>
    (function () {
      const SILENCE = false; // keep false to see errors while integrating payments
      if (!SILENCE) return;

      const noop = function () {};
      const c = (window.console = window.console || {});
      ["log","info","debug","warn","error","trace","group","groupCollapsed","groupEnd"]
        .forEach(k => { try { c[k] = noop; } catch (_) {} });

      window.addEventListener("error", e => {
        e.preventDefault(); e.stopImmediatePropagation(); return false;
      }, true);
      window.addEventListener("unhandledrejection", e => {
        e.preventDefault(); e.stopImmediatePropagation(); return false;
      }, true);
    })();
  </script>

  <style id="splash-screen-style">
    html { height: 100% }
    body {
      margin: 0;
      min-height: 100%;
      background-color: #FFFFFF;
      background-size: 100% 100%;
    }
    .center {
      margin: 0;
      position: absolute;
      top: 50%;
      left: 50%;
      -ms-transform: translate(-50%, -50%);
      transform: translate(-50%, -50%);
    }
    .contain { display:block; width:100%; height:100%; object-fit: contain; }
    .stretch { display:block; width:100%; height:100%; }
    .cover   { display:block; width:100%; height:100%; object-fit: cover; }
    .bottom { position: absolute; bottom: 0; left: 50%; -ms-transform: translate(-50%, 0); transform: translate(-50%, 0); }
    .bottomLeft { position: absolute; bottom: 0; left: 0; }
    .bottomRight { position: absolute; bottom: 0; right: 0; }
    @media (prefers-color-scheme: dark) {
      body { background-color: #FFFFFF; }
    }
  </style>
  <script id="splash-screen-script">
    function removeSplashFromWeb() {
      document.getElementById("splash")?.remove();
      document.getElementById("splash-branding")?.remove();
      document.body.style.background = "transparent";
    }
  </script>

  <!-- ‚úÖ Razorpay Checkout (Web) + tiny JS bridge -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    window.openRazorpay = function(optionsJson) {
      console.log('üåê openRazorpay called');
      console.log('Options received:', optionsJson);

      try {
        if (!window.Razorpay) {
          console.error('‚ùå Razorpay SDK not loaded');
          if (window.razorpayError) window.razorpayError('Razorpay SDK not loaded');
          return;
        }

        // Parse options - handle both string and object
        let options;
        if (typeof optionsJson === 'string') {
          // If it's a string, we need to use eval to parse functions properly
          options = eval('(' + optionsJson + ')');
        } else {
          options = optionsJson;
        }

        console.log('‚úÖ Parsed options:', options);

        // Create and open Razorpay
        const rzp = new Razorpay(options);
        console.log('‚úÖ Razorpay instance created');

        rzp.open();
        console.log('‚úÖ Razorpay modal opened');

      } catch (e) {
        console.error('‚ùå openRazorpay error:', e);
        if (window.razorpayError) {
          window.razorpayError(e.toString());
        } else {
          alert('Payment init error: ' + e);
        }
      }
    };

    console.log('‚úÖ Razorpay bridge initialized');
  </script>
</head>
<body>
<picture id="splash">
  <source srcset="splash/img/light-1x.png 1x, splash/img/light-2x.png 2x, splash/img/light-3x.png 3x, splash/img/light-4x.png 4x" media="(prefers-color-scheme: light)">
  <source srcset="splash/img/dark-1x.png 1x, splash/img/dark-2x.png 2x, splash/img/dark-3x.png 3x, splash/img/dark-4x.png 4x" media="(prefers-color-scheme: dark)">
  <img class="center" aria-hidden="true" src="splash/img/light-1x.png" alt="">
</picture>

<!-- ‚úÖ Flutter bootstrap -->
<script src="flutter_bootstrap.js" defer></script>
</body>
</html>
